document.addEventListener("DOMContentLoaded",(function(){var e,t,n,a=document.getElementById("account-selector"),s=document.getElementById("period-selector"),o=document.getElementById("date-range-text"),i=null,c=null;function l(e){return(new Intl.NumberFormat).format(e)}function r(e){return(e>=0?"+":"")+e.toFixed(1)+"%"}function d(e,t){return 0===e?0:(t-e)/e*100}function u(e){return new Date(e).toLocaleDateString()}function p(e,t){var n=document.getElementById(e);n.classList.remove("positive","negative"),n.classList.add(t>=0?"positive":"negative")}function m(e,t){var n=function(e){var t=new Date,n=new Date;switch(e){case"this_month":n=new Date(t.getFullYear(),t.getMonth(),1);break;case"last_month":n=new Date(t.getFullYear(),t.getMonth()-1,1),t.setDate(0);break;default:n.setDate(t.getDate()-parseInt(e))}return{since:n.toISOString().split("T")[0],until:t.toISOString().split("T")[0]}}(t);jQuery.ajax({url:wpzoomInsights.ajaxurl,type:"POST",data:{action:"wpzoom_instagram_fetch_insights",nonce:wpzoomInsights.nonce,account_id:e,since_date:n.since,until_date:n.until},success:function(e){e.success&&e.data&&(function(e,t){var n=function(e){return new Date(e).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"})};o.textContent=wpzoomInsights.i18n.dateRangeFormat.replace("%s",n(e)).replace("%s",n(t))}(n.since,n.until),function(e){if(e.followers_stats){var t=e.followers_stats;document.getElementById("followers-count").textContent=l(t.total);var n=l(Math.abs(t.change))+" followers "+(t.change>=0?"gained":"lost"),a=" ("+(t.change>=0?"+":"-")+Math.abs(t.change_percentage).toFixed(1)+"%)";document.getElementById("followers-change").textContent=n+a,p("followers-change",t.change),document.getElementById("followers-period").textContent="Started with "+l(t.period_start)+" followers, ended with "+l(t.period_end)}if(e.reach){var s=e.reach[e.reach.length-1].value;document.getElementById("reach-count").textContent=l(s);var o=d(e.reach[0].value,s);document.getElementById("reach-change").textContent=r(o),p("reach-change",o)}if(e.impressions){var m=e.impressions[e.impressions.length-1].value;document.getElementById("impressions-count").textContent=l(m);var v=d(e.impressions[0].value,m);document.getElementById("impressions-change").textContent=r(v),p("impressions-change",v)}if(e.accounts_engaged){var g=e.accounts_engaged[0].value;document.getElementById("engagement-count").textContent=l(g),document.getElementById("engagement-change").textContent="-"}if(e.profile_views){var h=e.profile_views[e.profile_views.length-1].value;document.getElementById("profile-views-count").textContent=l(h);var f=d(e.profile_views[0].value,h);document.getElementById("profile-views-change").textContent=r(f),p("profile-views-change",f)}var w,I;e.recent_media&&(w=e.recent_media,(I=document.getElementById("recent-posts")).innerHTML="",w.forEach((function(e){var t=document.createElement("div");t.className="recent-post";var n="VIDEO"===e.type||"REEL"===e.type?'\n                <div class="stat">\n                    <span class="label">Video Views:</span>\n                    <span class="value">'.concat(l(e.insights.video_views||0),'</span>\n                </div>\n                <div class="stat">\n                    <span class="label">Plays:</span>\n                    <span class="value">').concat(l(e.insights.plays||0),"</span>\n                </div>\n            "):"";t.innerHTML='\n                <div class="post-thumbnail">\n                    <img src="'.concat(e.thumbnail,'" alt="').concat(e.caption,'">\n                </div>\n                <div class="post-content">\n                    <div class="post-caption">').concat(e.caption,'</div>\n                    <div class="post-stats">\n                        <div class="stat">\n                            <span class="label">Impressions:</span>\n                            <span class="value">').concat(l(e.insights.impressions||0),'</span>\n                        </div>\n                        <div class="stat">\n                            <span class="label">Reach:</span>\n                            <span class="value">').concat(l(e.insights.reach||0),'</span>\n                        </div>\n                        <div class="stat">\n                            <span class="label">Likes:</span>\n                            <span class="value">').concat(l(e.likes||0),'</span>\n                        </div>\n                        <div class="stat">\n                            <span class="label">Comments:</span>\n                            <span class="value">').concat(l(e.comments||0),'</span>\n                        </div>\n                        <div class="stat">\n                            <span class="label">Saved:</span>\n                            <span class="value">').concat(l(e.insights.saved||0),"</span>\n                        </div>\n                        ").concat(n,'\n                        <div class="stat">\n                            <span class="label">Total Interactions:</span>\n                            <span class="value">').concat(l(e.insights.total_interactions||0),'</span>\n                        </div>\n                    </div>\n                    <div class="post-meta">\n                        <a href="').concat(e.url,'" target="_blank" class="view-post">View Post</a>\n                        <span class="post-date">').concat(u(e.timestamp),"</span>\n                    </div>\n                </div>\n            "),I.appendChild(t)}))),function(e){if(e.reach&&e.impressions){var t=e.reach.map((function(e){return u(e.end_time)})),n=e.reach.map((function(e){return e.value})),a=e.impressions.map((function(e){return e.value}));e.follower_count&&(i.data.labels=t,i.data.datasets[0].data=e.follower_count.map((function(e){return e.value})),i.update()),c.data.labels=t,c.data.datasets[0].data=n,c.data.datasets[1].data=a,c.update()}}(e)}(e.data))},error:function(e,t,n){console.error("Error fetching insights:",n)}})}a&&s&&(e=document.getElementById("followers-chart").getContext("2d"),t=document.getElementById("engagement-chart").getContext("2d"),n={responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0}}},i=new Chart(e,{type:"line",data:{labels:[],datasets:[{label:wpzoomInsights.i18n.followers,data:[],borderColor:"rgb(75, 192, 192)",tension:.1}]},options:n}),c=new Chart(t,{type:"line",data:{labels:[],datasets:[{label:wpzoomInsights.i18n.reach,data:[],borderColor:"rgb(255, 99, 132)",tension:.1},{label:wpzoomInsights.i18n.impressions,data:[],borderColor:"rgb(54, 162, 235)",tension:.1}]},options:n}),m(a.value,s.value),a.addEventListener("change",(function(){m(this.value,s.value)})),s.addEventListener("change",(function(){m(a.value,this.value)})))}));